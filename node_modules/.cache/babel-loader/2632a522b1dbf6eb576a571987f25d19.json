{"ast":null,"code":"import { EarlyExitException, isRecognitionException, NoViableAltException } from \"../../exceptions_public\";\nimport { cloneArr, has } from \"../../../utils/utils\";\nimport { getLookaheadPathsForOptionalProd, getLookaheadPathsForOr } from \"../../grammar/lookahead\";\nimport { DEFAULT_PARSER_CONFIG } from \"../parser\";\n/**\n * Trait responsible for runtime parsing errors.\n */\n\nvar ErrorHandler =\n/** @class */\nfunction () {\n  function ErrorHandler() {}\n\n  ErrorHandler.prototype.initErrorHandler = function (config) {\n    this._errors = [];\n    this.errorMessageProvider = has(config, \"errorMessageProvider\") ? config.errorMessageProvider : DEFAULT_PARSER_CONFIG.errorMessageProvider;\n  };\n\n  ErrorHandler.prototype.SAVE_ERROR = function (error) {\n    if (isRecognitionException(error)) {\n      error.context = {\n        ruleStack: this.getHumanReadableRuleStack(),\n        ruleOccurrenceStack: cloneArr(this.RULE_OCCURRENCE_STACK)\n      };\n\n      this._errors.push(error);\n\n      return error;\n    } else {\n      throw Error(\"Trying to save an Error which is not a RecognitionException\");\n    }\n  };\n\n  Object.defineProperty(ErrorHandler.prototype, \"errors\", {\n    get: function get() {\n      return cloneArr(this._errors);\n    },\n    set: function set(newErrors) {\n      this._errors = newErrors;\n    },\n    enumerable: false,\n    configurable: true\n  }); // TODO: consider caching the error message computed information\n\n  ErrorHandler.prototype.raiseEarlyExitException = function (occurrence, prodType, userDefinedErrMsg) {\n    var ruleName = this.getCurrRuleFullName();\n    var ruleGrammar = this.getGAstProductions()[ruleName];\n    var lookAheadPathsPerAlternative = getLookaheadPathsForOptionalProd(occurrence, ruleGrammar, prodType, this.maxLookahead);\n    var insideProdPaths = lookAheadPathsPerAlternative[0];\n    var actualTokens = [];\n\n    for (var i = 1; i <= this.maxLookahead; i++) {\n      actualTokens.push(this.LA(i));\n    }\n\n    var msg = this.errorMessageProvider.buildEarlyExitMessage({\n      expectedIterationPaths: insideProdPaths,\n      actual: actualTokens,\n      previous: this.LA(0),\n      customUserDescription: userDefinedErrMsg,\n      ruleName: ruleName\n    });\n    throw this.SAVE_ERROR(new EarlyExitException(msg, this.LA(1), this.LA(0)));\n  }; // TODO: consider caching the error message computed information\n\n\n  ErrorHandler.prototype.raiseNoAltException = function (occurrence, errMsgTypes) {\n    var ruleName = this.getCurrRuleFullName();\n    var ruleGrammar = this.getGAstProductions()[ruleName]; // TODO: getLookaheadPathsForOr can be slow for large enough maxLookahead and certain grammars, consider caching ?\n\n    var lookAheadPathsPerAlternative = getLookaheadPathsForOr(occurrence, ruleGrammar, this.maxLookahead);\n    var actualTokens = [];\n\n    for (var i = 1; i <= this.maxLookahead; i++) {\n      actualTokens.push(this.LA(i));\n    }\n\n    var previousToken = this.LA(0);\n    var errMsg = this.errorMessageProvider.buildNoViableAltMessage({\n      expectedPathsPerAlt: lookAheadPathsPerAlternative,\n      actual: actualTokens,\n      previous: previousToken,\n      customUserDescription: errMsgTypes,\n      ruleName: this.getCurrRuleFullName()\n    });\n    throw this.SAVE_ERROR(new NoViableAltException(errMsg, this.LA(1), previousToken));\n  };\n\n  return ErrorHandler;\n}();\n\nexport { ErrorHandler };","map":{"version":3,"mappings":"AAKA,SACEA,kBADF,EAEEC,sBAFF,EAGEC,oBAHF,QAIO,yBAJP;AAKA,SAASC,QAAT,EAAmBC,GAAnB,QAA8B,sBAA9B;AACA,SACEC,gCADF,EAEEC,sBAFF,QAIO,yBAJP;AAMA,SAASC,qBAAT,QAAsC,WAAtC;AAEA;;;;AAGA;AAAA;AAAA;AAAA,2BAmGC;;AA/FCC,sDAAiBC,MAAjB,EAAsC;AACpC,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,oBAAL,GAA4BP,GAAG,CAACK,MAAD,EAAS,sBAAT,CAAH,GACxBA,MAAM,CAACE,oBADiB,GAExBJ,qBAAqB,CAACI,oBAF1B;AAGD,GALD;;AAOAH,gDAEEI,KAFF,EAE8B;AAE5B,QAAIX,sBAAsB,CAACW,KAAD,CAA1B,EAAmC;AACjCA,WAAK,CAACC,OAAN,GAAgB;AACdC,iBAAS,EAAE,KAAKC,yBAAL,EADG;AAEdC,2BAAmB,EAAEb,QAAQ,CAAC,KAAKc,qBAAN;AAFf,OAAhB;;AAIA,WAAKP,OAAL,CAAaQ,IAAb,CAAkBN,KAAlB;;AACA,aAAOA,KAAP;AACD,KAPD,MAOO;AACL,YAAMO,KAAK,CAAC,6DAAD,CAAX;AACD;AACF,GAdD;;AAgBAC,wBAAIZ,sBAAJ,EAAI,QAAJ,EAAU;SAAV;AACE,aAAOL,QAAQ,CAAC,KAAKO,OAAN,CAAf;AACD,KAFS;SAIV,aAAWW,SAAX,EAA6C;AAC3C,WAAKX,OAAL,GAAeW,SAAf;AACD,KANS;qBAAA;;AAAA,GAAV,EA3BF,CAmCE;;AACAb,6DAEEc,UAFF,EAGEC,QAHF,EAIEC,iBAJF,EAI2B;AAEzB,QAAIC,QAAQ,GAAG,KAAKC,mBAAL,EAAf;AACA,QAAIC,WAAW,GAAG,KAAKC,kBAAL,GAA0BH,QAA1B,CAAlB;AACA,QAAII,4BAA4B,GAAGxB,gCAAgC,CACjEiB,UADiE,EAEjEK,WAFiE,EAGjEJ,QAHiE,EAIjE,KAAKO,YAJ4D,CAAnE;AAMA,QAAIC,eAAe,GAAGF,4BAA4B,CAAC,CAAD,CAAlD;AACA,QAAIG,YAAY,GAAG,EAAnB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,KAAKH,YAA1B,EAAwCG,CAAC,EAAzC,EAA6C;AAC3CD,kBAAY,CAACd,IAAb,CAAkB,KAAKgB,EAAL,CAAQD,CAAR,CAAlB;AACD;;AACD,QAAIE,GAAG,GAAG,KAAKxB,oBAAL,CAA0ByB,qBAA1B,CAAgD;AACxDC,4BAAsB,EAAEN,eADgC;AAExDO,YAAM,EAAEN,YAFgD;AAGxDO,cAAQ,EAAE,KAAKL,EAAL,CAAQ,CAAR,CAH8C;AAIxDM,2BAAqB,EAAEhB,iBAJiC;AAKxDC,cAAQ,EAAEA;AAL8C,KAAhD,CAAV;AAQA,UAAM,KAAKgB,UAAL,CAAgB,IAAIzC,kBAAJ,CAAuBmC,GAAvB,EAA4B,KAAKD,EAAL,CAAQ,CAAR,CAA5B,EAAwC,KAAKA,EAAL,CAAQ,CAAR,CAAxC,CAAhB,CAAN;AACD,GA5BD,CApCF,CAkEE;;;AACA1B,yDAEEc,UAFF,EAGEoB,WAHF,EAGqB;AAEnB,QAAIjB,QAAQ,GAAG,KAAKC,mBAAL,EAAf;AACA,QAAIC,WAAW,GAAG,KAAKC,kBAAL,GAA0BH,QAA1B,CAAlB,CAHmB,CAInB;;AACA,QAAII,4BAA4B,GAAGvB,sBAAsB,CACvDgB,UADuD,EAEvDK,WAFuD,EAGvD,KAAKG,YAHkD,CAAzD;AAMA,QAAIE,YAAY,GAAG,EAAnB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,KAAKH,YAA1B,EAAwCG,CAAC,EAAzC,EAA6C;AAC3CD,kBAAY,CAACd,IAAb,CAAkB,KAAKgB,EAAL,CAAQD,CAAR,CAAlB;AACD;;AACD,QAAIU,aAAa,GAAG,KAAKT,EAAL,CAAQ,CAAR,CAApB;AAEA,QAAIU,MAAM,GAAG,KAAKjC,oBAAL,CAA0BkC,uBAA1B,CAAkD;AAC7DC,yBAAmB,EAAEjB,4BADwC;AAE7DS,YAAM,EAAEN,YAFqD;AAG7DO,cAAQ,EAAEI,aAHmD;AAI7DH,2BAAqB,EAAEE,WAJsC;AAK7DjB,cAAQ,EAAE,KAAKC,mBAAL;AALmD,KAAlD,CAAb;AAQA,UAAM,KAAKe,UAAL,CACJ,IAAIvC,oBAAJ,CAAyB0C,MAAzB,EAAiC,KAAKV,EAAL,CAAQ,CAAR,CAAjC,EAA6CS,aAA7C,CADI,CAAN;AAGD,GA/BD;;AAgCF;AAAC,CAnGD","names":["EarlyExitException","isRecognitionException","NoViableAltException","cloneArr","has","getLookaheadPathsForOptionalProd","getLookaheadPathsForOr","DEFAULT_PARSER_CONFIG","ErrorHandler","config","_errors","errorMessageProvider","error","context","ruleStack","getHumanReadableRuleStack","ruleOccurrenceStack","RULE_OCCURRENCE_STACK","push","Error","Object","newErrors","occurrence","prodType","userDefinedErrMsg","ruleName","getCurrRuleFullName","ruleGrammar","getGAstProductions","lookAheadPathsPerAlternative","maxLookahead","insideProdPaths","actualTokens","i","LA","msg","buildEarlyExitMessage","expectedIterationPaths","actual","previous","customUserDescription","SAVE_ERROR","errMsgTypes","previousToken","errMsg","buildNoViableAltMessage","expectedPathsPerAlt"],"sourceRoot":"","sources":["../../../../../src/parse/parser/traits/error_handler.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}