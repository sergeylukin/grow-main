{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { assign, forEach, isRegExp, map, pick } from \"../../../utils/utils\";\nimport { tokenLabel } from \"../../../scan/tokens_public\";\n\nvar AbstractProduction =\n/** @class */\nfunction () {\n  function AbstractProduction(_definition) {\n    this._definition = _definition;\n  }\n\n  Object.defineProperty(AbstractProduction.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AbstractProduction.prototype.accept = function (visitor) {\n    visitor.visit(this);\n    forEach(this.definition, function (prod) {\n      prod.accept(visitor);\n    });\n  };\n\n  return AbstractProduction;\n}();\n\nexport { AbstractProduction };\n\nvar NonTerminal =\n/** @class */\nfunction (_super) {\n  __extends(NonTerminal, _super);\n\n  function NonTerminal(options) {\n    var _this = _super.call(this, []) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  Object.defineProperty(NonTerminal.prototype, \"definition\", {\n    get: function get() {\n      if (this.referencedRule !== undefined) {\n        return this.referencedRule.definition;\n      }\n\n      return [];\n    },\n    set: function set(definition) {// immutable\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  NonTerminal.prototype.accept = function (visitor) {\n    visitor.visit(this); // don't visit children of a reference, we will get cyclic infinite loops if we do so\n  };\n\n  return NonTerminal;\n}(AbstractProduction);\n\nexport { NonTerminal };\n\nvar Rule =\n/** @class */\nfunction (_super) {\n  __extends(Rule, _super);\n\n  function Rule(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.orgText = \"\";\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Rule;\n}(AbstractProduction);\n\nexport { Rule };\n\nvar Alternative =\n/** @class */\nfunction (_super) {\n  __extends(Alternative, _super);\n\n  function Alternative(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.ignoreAmbiguities = false;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Alternative;\n}(AbstractProduction);\n\nexport { Alternative };\n\nvar Option =\n/** @class */\nfunction (_super) {\n  __extends(Option, _super);\n\n  function Option(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Option;\n}(AbstractProduction);\n\nexport { Option };\n\nvar RepetitionMandatory =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionMandatory, _super);\n\n  function RepetitionMandatory(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionMandatory;\n}(AbstractProduction);\n\nexport { RepetitionMandatory };\n\nvar RepetitionMandatoryWithSeparator =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionMandatoryWithSeparator, _super);\n\n  function RepetitionMandatoryWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionMandatoryWithSeparator;\n}(AbstractProduction);\n\nexport { RepetitionMandatoryWithSeparator };\n\nvar Repetition =\n/** @class */\nfunction (_super) {\n  __extends(Repetition, _super);\n\n  function Repetition(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Repetition;\n}(AbstractProduction);\n\nexport { Repetition };\n\nvar RepetitionWithSeparator =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionWithSeparator, _super);\n\n  function RepetitionWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionWithSeparator;\n}(AbstractProduction);\n\nexport { RepetitionWithSeparator };\n\nvar Alternation =\n/** @class */\nfunction (_super) {\n  __extends(Alternation, _super);\n\n  function Alternation(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    _this.ignoreAmbiguities = false;\n    _this.hasPredicates = false;\n    assign(_this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  Object.defineProperty(Alternation.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return Alternation;\n}(AbstractProduction);\n\nexport { Alternation };\n\nvar Terminal =\n/** @class */\nfunction () {\n  function Terminal(options) {\n    this.idx = 1;\n    assign(this, pick(options, function (v) {\n      return v !== undefined;\n    }));\n  }\n\n  Terminal.prototype.accept = function (visitor) {\n    visitor.visit(this);\n  };\n\n  return Terminal;\n}();\n\nexport { Terminal };\nexport function serializeGrammar(topRules) {\n  return map(topRules, serializeProduction);\n}\nexport function serializeProduction(node) {\n  function convertDefinition(definition) {\n    return map(definition, serializeProduction);\n  }\n  /* istanbul ignore else */\n\n\n  if (node instanceof NonTerminal) {\n    return {\n      type: \"NonTerminal\",\n      name: node.nonTerminalName,\n      idx: node.idx\n    };\n  } else if (node instanceof Alternative) {\n    return {\n      type: \"Alternative\",\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Option) {\n    return {\n      type: \"Option\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatory) {\n    return {\n      type: \"RepetitionMandatory\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatoryWithSeparator) {\n    return {\n      type: \"RepetitionMandatoryWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionWithSeparator) {\n    return {\n      type: \"RepetitionWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Repetition) {\n    return {\n      type: \"Repetition\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Alternation) {\n    return {\n      type: \"Alternation\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Terminal) {\n    var serializedTerminal = {\n      type: \"Terminal\",\n      name: node.terminalType.name,\n      label: tokenLabel(node.terminalType),\n      idx: node.idx\n    };\n    var pattern = node.terminalType.PATTERN;\n\n    if (node.terminalType.PATTERN) {\n      serializedTerminal.pattern = isRegExp(pattern) ? pattern.source : pattern;\n    }\n\n    return serializedTerminal;\n  } else if (node instanceof Rule) {\n    return {\n      type: \"Rule\",\n      name: node.name,\n      orgText: node.orgText,\n      definition: convertDefinition(node.definition)\n    };\n  } else {\n    throw Error(\"non exhaustive match\");\n  }\n}","map":{"version":3,"mappings":"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","names":["assign","forEach","isRegExp","map","pick","tokenLabel","_definition","Object","AbstractProduction","value","visitor","visit","definition","prod","accept","__extends","options","_super","_this","v","undefined","NonTerminal","referencedRule","Alternation","Terminal","serializeGrammar","topRules","serializeProduction","node","convertDefinition","type","name","nonTerminalName","idx","Alternative","Option","RepetitionMandatory","RepetitionMandatoryWithSeparator","separator","terminalType","RepetitionWithSeparator","Repetition","serializedTerminal","label","pattern","PATTERN","source","Rule","orgText","Error"],"sourceRoot":"","sources":["../../../../../src/parse/grammar/gast/gast_public.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}